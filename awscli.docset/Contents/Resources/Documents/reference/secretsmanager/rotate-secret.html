<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
  
    <title>rotate-secret — AWS CLI 1.16.299 Command Reference</title>
  <link rel="stylesheet" type="text/css" href="../../_static/bootstrap.min.css">
  <script type="text/javascript" src="../../_static/jquery-1.9.1.min.js"></script>
  <script src="/SdkStatic/sdk-priv.js" async="true"></script>
    
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css">
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.16.299',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="AWS CLI 1.16.299 Command Reference" href="../../index.html">
    <link rel="up" title="secretsmanager" href="index.html">
    <link rel="next" title="tag-resource" href="tag-resource.html">
    <link rel="prev" title="restore-secret" href="restore-secret.html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-responsive.min.css">
  
   

  </head>
  <body>
  
  
  <!--REGION_DISCLAIMER_DO_NOT_REMOVE-->

    
    <div class="container">
        
    
  
        <div class="document clearer">
      
            <div class="body">
              
  
<div class="section" id="rotate-secret">
<span id="cli-aws-secretsmanager-rotate-secret"></span><h1>rotate-secret<a class="headerlink" href="#rotate-secret" title="Permalink to this headline">¶</a>
</h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a>
</h2>
<p>Configures and starts the asynchronous process of rotating this secret. If you include the configuration parameters, the operation sets those values for the secret and then immediately starts a rotation. If you do not include the configuration parameters, the operation starts a rotation with the values already stored in the secret. After the rotation completes, the protected service and its clients all use the new version of the secret.</p>
<p>This required configuration information includes the ARN of an AWS Lambda function and the time between scheduled rotations. The Lambda rotation function creates a new version of the secret and creates or updates the credentials on the protected service to match. After testing the new credentials, the function marks the new secret with the staging label <tt class="docutils literal"><span class="pre">AWSCURRENT</span></tt> so that your clients all immediately begin to use the new version. For more information about rotating secrets and how to configure a Lambda function to rotate the secrets for your protected service, see <a class="reference external" href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html">Rotating Secrets in AWS Secrets Manager</a> in the <em>AWS Secrets Manager User Guide</em> .</p>
<p>Secrets Manager schedules the next rotation when the previous one is complete. Secrets Manager schedules the date by adding the rotation interval (number of days) to the actual date of the last rotation. The service chooses the hour within that 24-hour date window randomly. The minute is also chosen somewhat randomly, but weighted towards the top of the hour and influenced by a variety of factors that help distribute load.</p>
<p>The rotation function must end with the versions of the secret in one of two states:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">AWSPENDING</span></tt> and <tt class="docutils literal"><span class="pre">AWSCURRENT</span></tt> staging labels are attached to the same version of the secret, or</li>
<li>The <tt class="docutils literal"><span class="pre">AWSPENDING</span></tt> staging label is not attached to any version of the secret.</li>
</ul>
<p>If instead the <tt class="docutils literal"><span class="pre">AWSPENDING</span></tt> staging label is present but is not attached to the same version as <tt class="docutils literal"><span class="pre">AWSCURRENT</span></tt> then any later invocation of <tt class="docutils literal"><span class="pre">RotateSecret</span></tt> assumes that a previous rotation request is still in progress and returns an error.</p>
<blockquote>
<div><strong>Minimum permissions</strong></div>
</blockquote>
<p>To run this command, you must have the following permissions:</p>
<ul class="simple">
<li>secretsmanager:RotateSecret</li>
<li>lambda:InvokeFunction (on the function specified in the secret's metadata)</li>
</ul>
<blockquote>
<div><strong>Related operations</strong></div>
</blockquote>
<ul class="simple">
<li>To list the secrets in your account, use  ListSecrets .</li>
<li>To get the details for a version of a secret, use  DescribeSecret .</li>
<li>To create a new version of a secret, use  CreateSecret .</li>
<li>To attach staging labels to or remove staging labels from a version of a secret, use  UpdateSecretVersionStage .</li>
</ul>
<p>See also: <a class="reference external" href="https://docs.aws.amazon.com/goto/WebAPI/secretsmanager-2017-10-17/RotateSecret">AWS API Documentation</a></p>
<p>See <a class="reference internal" href="../index.html"><em>'aws help'</em></a> for descriptions of global parameters.</p>
</div>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a>
</h2>
<div class="highlight-python">
<pre>  rotate-secret
--secret-id &lt;value&gt;
[--client-request-token &lt;value&gt;]
[--rotation-lambda-arn &lt;value&gt;]
[--rotation-rules &lt;value&gt;]
[--cli-input-json &lt;value&gt;]
[--generate-cli-skeleton &lt;value&gt;]</pre>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a>
</h2>
<p><tt class="docutils literal"><span class="pre">--secret-id</span></tt> (string)</p>
<blockquote>
<div>
<p>Specifies the secret that you want to rotate. You can specify either the Amazon Resource Name (ARN) or the friendly name of the secret.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you specify an ARN, we generally recommend that you specify a complete ARN. You can specify a partial ARN too—for example, if you don’t include the final hyphen and six random characters that Secrets Manager adds at the end of the ARN when you created the secret. A partial ARN match can work as long as it uniquely matches only one secret. However, if your secret has a name that ends in a hyphen followed by six characters (before Secrets Manager adds the hyphen and six characters to the ARN) and you try to use that as a partial ARN, then those characters cause Secrets Manager to assume that you’re specifying a complete ARN. This confusion can cause unexpected results. To avoid this situation, we recommend that you don’t create secret names that end with a hyphen followed by six characters.</p>
</div>
</div>
</blockquote>
<p><tt class="docutils literal"><span class="pre">--client-request-token</span></tt> (string)</p>
<blockquote>
<div>
<p>(Optional) Specifies a unique identifier for the new version of the secret that helps ensure idempotency.</p>
<p>If you use the AWS CLI or one of the AWS SDK to call this operation, then you can leave this parameter empty. The CLI or SDK generates a random UUID for you and includes that in the request for this parameter. If you don't use the SDK and instead generate a raw HTTP request to the Secrets Manager service endpoint, then you must generate a <tt class="docutils literal"><span class="pre">ClientRequestToken</span></tt> yourself for new versions and include that value in the request.</p>
<p>You only need to specify your own value if you are implementing your own retry logic and want to ensure that a given secret is not created twice. We recommend that you generate a <a class="reference external" href="https://wikipedia.org/wiki/Universally_unique_identifier">UUID-type</a> value to ensure uniqueness within the specified secret.</p>
<p>Secrets Manager uses this value to prevent the accidental creation of duplicate versions if there are failures and retries during the function's processing. This value becomes the <tt class="docutils literal"><span class="pre">VersionId</span></tt> of the new version.</p>
</div>
</blockquote>
<p><tt class="docutils literal"><span class="pre">--rotation-lambda-arn</span></tt> (string)</p>
<blockquote>
<div>(Optional) Specifies the ARN of the Lambda function that can rotate the secret.</div>
</blockquote>
<p><tt class="docutils literal"><span class="pre">--rotation-rules</span></tt> (structure)</p>
<blockquote>
<div>A structure that defines the rotation configuration for this secret.</div>
</blockquote>
<p>Shorthand Syntax:</p>
<div class="highlight-python">
<div class="highlight"><pre><span></span><span class="n">AutomaticallyAfterDays</span><span class="o">=</span><span class="nb">long</span>
</pre></div>
</div>
<p>JSON Syntax:</p>
<div class="highlight-python">
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">"AutomaticallyAfterDays"</span><span class="p">:</span> <span class="nb">long</span>
<span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">--cli-input-json</span></tt> (string)
Performs service operation based on the JSON string provided. The JSON string follows the format provided by <tt class="docutils literal"><span class="pre">--generate-cli-skeleton</span></tt>. If other arguments are provided on the command line, the CLI values will override the JSON-provided values. It is not possible to pass arbitrary binary values using a JSON-provided value as the string will be taken literally.</p>
<p><tt class="docutils literal"><span class="pre">--generate-cli-skeleton</span></tt> (string)
Prints a JSON skeleton to standard output without sending an API request. If provided with no value or the value <tt class="docutils literal"><span class="pre">input</span></tt>, prints a sample input JSON that can be used as an argument for <tt class="docutils literal"><span class="pre">--cli-input-json</span></tt>. If provided with the value <tt class="docutils literal"><span class="pre">output</span></tt>, it validates the command inputs and returns a sample output JSON for that command.</p>
<p>See <a class="reference internal" href="../index.html"><em>'aws help'</em></a> for descriptions of global parameters.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a>
</h2>
<p><strong>To configure rotation for a secret</strong></p>
<p>The following example configures rotation for a secret by providing the ARN of a Lambda rotation function (which must already exist) and the number of days between rotation. The first rotation happens immediately upon completion of this command. The rotation function runs asynchronously in the background.</p>
<div class="highlight-python">
<pre>aws secretsmanager rotate-secret --secret-id MyTestDatabaseSecret \
  --rotation-lambda-arn arn:aws:lambda:us-west-2:1234566789012:function:MyTestRotationLambda \
  --rotation-rules AutomaticallyAfterDays=30</pre>
</div>
<p>The output shows the following, including the <tt class="docutils literal"><span class="pre">VersionId</span></tt> of the new secret version:</p>
<div class="highlight-python">
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">"ARN"</span><span class="p">:</span> <span class="s2">"aws:arn:secretsmanager:us-west-2:123456789012:secret:MyTestDatabaseSecret-a1b2c3"</span><span class="p">,</span>
  <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"MyTestDatabaseSecret"</span><span class="p">,</span>
  <span class="s2">"VersionId"</span><span class="p">:</span> <span class="s2">"EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE"</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>To request an immediate rotation for a secret</strong></p>
<p>The following example requests an immediate invocation of the secret's Lambda rotation function. It assumes that the specified secret already has rotation configured. The rotation function runs asynchronously in the background.</p>
<div class="highlight-python">
<pre>aws secretsmanager rotate-secret --secret-id MyTestDatabaseSecret</pre>
</div>
<p>The output shows the following, including the <tt class="docutils literal"><span class="pre">VersionId</span></tt> of the new secret version:</p>
<div class="highlight-python">
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">"ARN"</span><span class="p">:</span> <span class="s2">"aws:arn:secretsmanager:us-west-2:123456789012:secret:MyTestDatabaseSecret-a1b2c3"</span><span class="p">,</span>
  <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"MyTestDatabaseSecret"</span><span class="p">,</span>
  <span class="s2">"VersionId"</span><span class="p">:</span> <span class="s2">"EXAMPLE2-90ab-cdef-fedc-ba987EXAMPLE"</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a>
</h2>
<p>ARN -&gt; (string)</p>
<blockquote>
<div>The ARN of the secret.</div>
</blockquote>
<p>Name -&gt; (string)</p>
<blockquote>
<div>The friendly name of the secret.</div>
</blockquote>
<p>VersionId -&gt; (string)</p>
<blockquote>
<div>The ID of the new version of the secret created by the rotation started by this request.</div>
</blockquote>
</div>
</div>


            </div>
          <div class="clearfix"></div>
        </div>
        
    
  

    </div>
  <script type="text/javascript" src="https://media.amazonwebservices.com/js/sitecatalyst/s_code.min.js"></script>
  <script type="text/javascript">
  s.prop66 = 'AWS CLI';
  s.eVar66 = 'D=c66';
  s.prop65 = 'API Reference';
  s.eVar65 = 'D=c65';
  var s_code = s.t();
  if (s_code) document.write(s_code);
  </script>
    
  



  
    
  
  </body>
</html>
